
<style>

    .highcharts-figure,
    .highcharts-data-table table {
        min-width: 360px;
        max-width: 800px;
        margin: 1em auto;
    }

    .highcharts-data-table table {
        font-family: Verdana, sans-serif;
        border-collapse: collapse;
        border: 1px solid #ebebeb;
        margin: 10px auto;
        text-align: center;
        width: 100%;
        max-width: 500px;
    }

    .highcharts-data-table caption {
        padding: 1em 0;
        font-size: 1.2em;
        color: #555;
    }

    .highcharts-data-table th {
        font-weight: 600;
        padding: 0.5em;
    }

    .highcharts-data-table td,
    .highcharts-data-table th,
    .highcharts-data-table caption {
        padding: 0.5em;
    }

    .highcharts-data-table thead tr,
    .highcharts-data-table tr:nth-child(even) {
        background: #f8f8f8;
    }

    .highcharts-data-table tr:hover {
        background: #f1f7ff;
    }

    .highcharts-figure,
    .highcharts-data-table table {
        min-width: 310px;
        max-width: 800px;
        margin: 1em auto;
    }

    #container {
        height: 400px;
    }

    .highcharts-data-table table {
        font-family: Verdana, sans-serif;
        border-collapse: collapse;
        border: 1px solid #ebebeb;
        margin: 10px auto;
        text-align: center;
        width: 100%;
        max-width: 500px;
    }

    .highcharts-data-table caption {
        padding: 1em 0;
        font-size: 1.2em;
        color: #555;
    }

    .highcharts-data-table th {
        font-weight: 600;
        padding: 0.5em;
    }

    .highcharts-data-table td,
    .highcharts-data-table th,
    .highcharts-data-table caption {
        padding: 0.5em;
    }

    .highcharts-data-table thead tr,
    .highcharts-data-table tr:nth-child(even) {
        background: #f8f8f8;
    }

    .highcharts-data-table tr:hover {
        background: #f1f7ff;
    }

    .highcharts-figure,
    .highcharts-data-table table {
        min-width: 320px;
        max-width: 800px;
        margin: 1em auto;
    }

    .highcharts-data-table table {
        font-family: Verdana, sans-serif;
        border-collapse: collapse;
        border: 1px solid #ebebeb;
        margin: 10px auto;
        text-align: center;
        width: 100%;
        max-width: 500px;
    }

    .highcharts-data-table caption {
        padding: 1em 0;
        font-size: 1.2em;
        color: #555;
    }

    .highcharts-data-table th {
        font-weight: 600;
        padding: 0.5em;
    }

    .highcharts-data-table td,
    .highcharts-data-table th,
    .highcharts-data-table caption {
        padding: 0.5em;
    }

    .highcharts-data-table thead tr,
    .highcharts-data-table tr:nth-child(even) {
        background: #f8f8f8;
    }

    .highcharts-data-table tr:hover {
        background: #f1f7ff;
    }

    input[type="number"] {
        min-width: 50px;
    }

</style>

<div id="vc_app">
    <div class="container-fluid p-3">

        <div class="card mt-2" v-cloak>

            <div class="card-body">

                <div class="col-12">

                    <div class="button-container">

                        <div class="input-group input-group-sm" style="width: 1000px; margin-left: 1px;">

                            <div class="input-group-prepend">
                                <label class="input-group-text" for="">Department</label>
                            </div>


                            <select class="custom-select" id="DepartmentId" v-model="selectedDepartment" @@change="Onchange()">
                                <option value="1">EBL Migration</option>
                                <option value="2">EBL POC</option>
                            </select>


                            <div class="input-group-prepend">
                                <label class="input-group-text" id="lblDataClass" for="balanceSheetDropdown">M Data Class</label>
                            </div>


                            <select v-model="SelectDocClassType" class="custom-select">
                                <option v-for="item in portalList" :key="item.datA_CLASS" :value="item.datA_CLASS">
                                    {{ item.datA_CLASS }}
                                </option>
                            </select>


                            <div class="input-group-prepend">
                                <label class="input-group-text" id="lblStatus" for="balanceSheetDropdown">M Status</label>
                            </div>

                            <select v-model="selectedGameType" class="custom-select">
                                <option value="0">Select Status</option>
                                <option v-for="item in statusPopulate" :key="item.status" :value="item.status">
                                    {{ item.status }}
                                </option>
                            </select>

                            <div class="input-group-prepend">
                                <label class="input-group-text" for="balanceSheetDropdown">From Date</label>
                            </div>
                            <input type="date" class="form-control" placeholder="From Date" required v-model="ListFromDate">

                            <div class="input-group-prepend">
                                <label class="input-group-text" for="balanceSheetDropdown">To Date</label>
                            </div>
                            <input type="date" class="form-control" placeholder="To Date" required v-model="ListToDate">

                            <div class="input-group-prepend">

                                <button type="button" class="btn btn-outline-info btn-sm" @@Click="getData()">Search</button>
                            </div>

                        </div>

                    </div>

                </div>

            </div>

        </div>

        <div class="card mt-2" v-cloak>
            <div class="card-body">

                <div class="col-12" id="OnlinegameLstId" v-if="selectedDepartment==1">

                    <div class="row">

                        <div class="col-md-5">
                            <h4>EBL Migration List</h4>
                        </div>
                        <div class="col-md-4">
                            <button v-on:click="exportToExcel" class="btn btn-outline-info btn-sm">Excel</button>
                            <button id="downloadPdf" class="btn btn-outline-info btn-sm">PDF</button>
                            <button id="EamilSend" class="btn btn-outline-info btn-sm" @@click="SendMain">Mail</button>
                        </div>
                    </div>

                    <div style="overflow-x: auto;">

                        <table class="table table-bordered table-striped" id="gameTable" style="table-layout: fixed;">

                            <thead>
                                <tr>
                                    <th>Data Class </th>
                                    <th>Account No</th>
                                    <th>Status </th>
                                    <th>Document</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="game in filteredGames" :key="game.DWDOCID">
                                    <td>{{ game.datA_CLASS }}</td>
                                    <td>{{ game.accounT_NO }}</td>
                                    <td>{{ game.status }}</td>



                                    <td><button class="btn btn-outline-info btn-sm" @@click="openUrl('https://presentationvm/DocuWare/Platform/WebClient/24750358-8e9c-4e5c-be1d-3d781846c471/Integration?fc=589317ba-3a03-43fb-b882-eac5682d5fa1&did=' + game.dwdocid + '&p=V')">View <i class="fa fa-angle-double-right"></i></button></td>

@* 
                                    <td><button class="btn btn-outline-info btn-sm" @@click="openUrl('https://presentationvm/DocuWare/Platform/WebClient/Client/Document?did=' + game.dwdocid + '&fc=589317ba-3a03-43fb-b882-eac5682d5fa1&queryInInvariantCulture=False&intgParams=JmVwPThGTkRKZlhsRXA2eUdrX1FLdzVpdF9qbWFHMnJ0ZERSemh4M0E1MVQwNmVkZk9hSUsxY3BpVUNDR0hqVFNaS0tqYjIxMUZYZWd3a3hBRWZmMTJ5amJZQ1E0NFo4c0d4LVp5MFBWbi1BS0QzbG9fM1BsQ1E2N3lyVXZKSnBfMjhiMA2&_auth=r5l4a3aLzPCZEX3-d6wjClfgXc0IODDqidEJGjNXRtgN3flATRG026YOUnYI-BZardVrX-SEBxi9quCaVk3FCoTRZQkFovpL1n2cAqyIaIYzjlLf9YzyWFybdh1xneHxtuP-DymuZBzuK-D0bbkEvDITilFsvL5uYYZlVTM1the4jtjkI_6_vLJjS0aohax-qbtpwsz-X-wly0McYzwD6ymq32O37JSW-M82rArl5gFAMGqowsFAHVRkT4KFBrnFPcC763-b7pygdKanahVBrDA73bGnCBKA_7OrkN_S5zMVscZiOSopSEvfOi3MVwGwQlrmq_kmPRGvd-uHr-zzAEzH5oVjE8cIiBP8PD1ljXTZ6pEi0GH33NFgdGRnlt1GEgun41sf9IoHmHdjichIaAnPzIcOm3hSgQ6OJvnvft8HuCHTsYtommw44ES-1mwJs_MWSq-vi17JhvCg6kaq5z5nsxSPoyPdDIyVRCwQS2yBEYZDM5BoLT4_iBEtFF4TojX_lUQ_5QImiuL1h3kY_KvAE76ySYDrqKaTa7U9Hr5VpTP2ZGBYvFDo8TC9m_DYMhumMakheTbUY1flxtW-UsrJzOD-1v1shSCI7m-k_cI1')">View <i class="fa fa-angle-double-right"></i></button></td> *@




                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="col-12" id="OnlinegameLstId" v-if="selectedDepartment==2">

                    <div class="row">
                        <div class="col-md-5">
                            <h4>EBL POC List</h4>
                        </div>
                        <div class="col-md-4">
                            <button v-on:click="exportToExcelPOC" class="btn btn-outline-info btn-sm">Excel</button>
                            <button id="downloadPdf" class="btn btn-outline-info btn-sm">PDF</button>
                            <button id="EamilSende" class="btn btn-outline-info btn-sm" @@click="SendMain">Mail</button>
                        </div>
                    </div>

                    <div style="overflow-x: auto;">

                        <table class="table table-bordered table-striped" id="gameTable" style="table-layout: fixed;">

                            <thead>
                                <tr>
                                    <th>Data Class </th>
                                    <th>Account No </th>
                                    <th>Status </th>
                                    <th>Document</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="game in filteredGames" :key="game.DWDOCID">
                                    <td>{{ game.datA_CLASS }}</td>
                                    <td>{{ game.accounT_NO }}</td>
                                    <td>{{ game.status }}</td>
                                    @* <td><button class="btn btn-outline-info btn-sm" @@click="openUrl('https://presentationvm/DocuWare/Platform/WebClient/24750358-8e9c-4e5c-be1d-3d781846c471/Integration?fc=71a26a21-c727-4ea2-a05c-b7a2a14480ac&did=' + game.dwdocid + '&p=V')">View <i class="fa fa-angle-double-right"></i></button></td> *@


@*                                     <td><button class="btn btn-outline-info btn-sm" @@click="openUrl('https://presentationvm/DocuWare/Platform/WebClient/24750358-8e9c-4e5c-be1d-3d781846c471/Integration?fc=87581c95-04a4-424f-9b6b-825de0bad060&did=' + game.dwdocid + '&p=V')">View <i class="fa fa-angle-double-right"></i></button></td> *@




                                   <td><button class="btn btn-outline-info btn-sm" @@click="openUrl('https://presentationvm/DocuWare/Platform/WebClient/24750358-8e9c-4e5c-be1d-3d781846c471/Integration?fc=71a26a21-c727-4ea2-a05c-b7a2a14480ac&did=' + game.dwdocid + '&p=V')">View <i class="fa fa-angle-double-right"></i></button></td>

                                   
                                    
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
   
        <div class="modal" id="mdl_game" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Mail  Box</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-12">
                                <form action="javascript:;" data-vv-scope="frmgame">


                                    <div class="form-row">

                                        <div class="row col-12">

                                            <div class="col">

                                                <template>
                                                    <div>
                                                        <div class="input-group mb-3">
                                                            <div class="input-group-prepend">
                                                                <span style="font-size: 14px" class="input-group-text">Mail</span>
                                                            </div>

                                                            <select v-model="selectedEblEmployee" class="custom-select">
                                                                <option v-for="item in EmployeeInfo" :key="item.email" :value="item.email">
                                                                    {{ item.name }}
                                                                </option>
                                                            </select>

                                                        </div>

                                                    </div>
                                                </template>

                                            </div>

                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn_mail" class="btn btn-info" v-on:click="sendTableDataToBackend"><i class="fa fa-envelope"></i> Send</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

@section scripts {

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    @*   <script src="~/js/dashboard.js"></script>
 *@

    <script>

        var app = new Vue({

            el: '#vc_app',
            data() {
                return {
                    selectedEblEmployee: 'admin@petersengineering.com',
                    selectedPIEDepartment: '1',
                    portalList: [],
                    statusPopulate: [],
                    EmployeeInfo: [],
                    selectedCategory: '',
                    selectedGameType: '0',
                    selectedDepartment: '1',
                    SelectDocClassType: 'Select From List',
                    typeSelected: '',
                    games: [],
                    gateCategoryList: [],
                    searchTerm: '',
                    itemG: {},
                    isActiveChecked: false,
                    datatableOptions: {
                        searching: true,
                        paging: true,
                        lengthChange: false,
                        ordering: true,
                        info: false,
                        responsive: true,
                    },
                    filteredGames: [],
                    PiE: [],
                    BarChartZ: [],
                    LineChart: [],
                    dataa: [],
                    selectedFile: null,
                    xlsxLoaded: false,
                    jsPDFLoaded: false,
                    ListFromDate: null,
                    ListToDate: null,
                    graphFromDate: null,
                    graphToDate: null
                };
            },

            computed: {

            },
            methods: {

                SendMain() {
                    this.itemG = {};
                    $('#mdl_game').modal('show');
                },

                exportToExcel() {
                    if (!this.xlsxLoaded) return; // Check if XLSX library is loaded
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.json_to_sheet(this.filteredGames);
                    XLSX.utils.book_append_sheet(wb, ws, 'People');
                    XLSX.writeFile(wb, 'Eastern_Bank_PLC_Migration.xlsx');
                },

                exportToExcelPOC() {
                    if (!this.xlsxLoaded) return; // Check if XLSX library is loaded
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.json_to_sheet(this.filteredGames);
                    XLSX.utils.book_append_sheet(wb, ws, 'People');
                    XLSX.writeFile(wb, 'Eastern_Bank_PLC_POC.xlsx');
                },

                Onchange() {

                    if (this.selectedDepartment == "1") {

                        $('#lblDataClass').text('M Data Class');
                        $('#lblStatus').text('M Status');
                        // Data Class Populate
                        helper.get('api/EBL_Migration/EblDataClassPopulate',
                            { DepartmentId: this.selectedDepartment },
                            (response) => {
                                this.filteredGames = [];
                                this.portalList = [];
                                this.portalList = response;
                                this.SelectDocClassType = 'Select From List'
                            });

                        // Status Populate
                        helper.get('api/EBL_Migration/EblStatusPopulate',
                            { DepartmentId: this.selectedDepartment },
                            (response) => {
                                this.filteredGames = [];
                                this.statusPopulate = [];
                                this.statusPopulate = response;
                                this.selectedGameType = '0'
                                // console.log(response);
                            });
                    }
                    if (this.selectedDepartment == "2") {

                        $('#lblDataClass').text('Data Class');
                        $('#lblStatus').text('Status');
                        // Data Class Populate
                        helper.get('api/EBL_Migration/EblDataClassPopulate',
                            { DepartmentId: this.selectedDepartment },
                            (response) => {
                                this.filteredGames = [];
                                this.portalList = [];
                                this.portalList = response;
                                this.SelectDocClassType = 'Select From List'
                            });

                        // Status Populate
                        helper.get('api/EBL_Migration/EblStatusPopulate',
                            { DepartmentId: this.selectedDepartment },
                            (response) => {
                                this.filteredGames = [];
                                this.statusPopulate = [];
                                this.statusPopulate = response;
                                this.selectedGameType = '0'
                            });
                    }
                },

                GetEmployeeMailInfo() {
                    helper.get('api/EBLLogin/EBLEmployeeInfo',
                        {},
                        (response) => {
                            this.EmployeeInfo = [];
                            this.EmployeeInfo = response;

                        });
                },

             

                getData() {

                    const DepartmetId = this.selectedDepartment;
                    const gameTypeId = this.selectedGameType;
                    const DepartmentId = this.selectedDepartment;
                    const DocClass = this.SelectDocClassType;
                    const fromdate = this.ListFromDate;
                    const todate = this.ListToDate;
                    if (DepartmetId == 1) {

                        helper.get('api/EBL_Migration/MigrationList',
                            { DocClass: DocClass, status: gameTypeId, FromDate: fromdate, Todate: todate },
                            (response) => {

                                this.filteredGames = [];
                                this.filteredGames = response;
                                

                            });
                    }

                    if (DepartmetId == 2) {

                        helper.get('api/EBL_Migration/EBLPOCList',
                            { DocClass: DocClass, status: gameTypeId, FromDate: fromdate, Todate: todate },
                            (response) => {
                                this.filteredGames = [];
                                this.filteredGames = response;


                            });
                    }
                },

                sendTableDataToBackend() {

                    if (this.filteredGames == null || this.filteredGames == "undefined" || this.filteredGames == "") {

                        $.notify("There is no data in the list below", 'error');
                        $('#mdl_game').modal('hide');

                    } else {

                        var jsonData = {};

                        jsonData["MyProperty"] = this.selectedEblEmployee

                        var jsonObjs = [];

                        $.each(this.filteredGames, function (index, filteredGames) {

                            var theObj = {};
                            // Access properties of each JSON object
                            var dataClass = filteredGames.datA_CLASS;
                            var Account = filteredGames.accounT_NO;
                            var status = filteredGames.status;
                            var Date = filteredGames.dwstoredatetime;

                            theObj["M_DATA_CLASS"] = dataClass;
                            theObj["M_ACCOUNT_NO"] = Account;
                            theObj["STATUS"] = status;
                            theObj["DWSTOREDATETIME"] = Date;

                            jsonObjs.push(theObj);
                            jsonData["mailBodies"] = jsonObjs;

                        });

                        $.ajax({
                            url: '/login/Mailsend',
                            type: 'POST',
                            data: {
                                jsonData: jsonData
                            },
                            beforeSend: function () {
                                $('#btn_mail').prop('disabled', true);
                            },
                            success: function (response) {

                                if (response.success) {
                                    $('#btn_mail').prop('disabled', false);
                                    $('#mdl_game').modal('hide');
                                    $.notify(response.message, 'success');
                                } else {
                                    $('#btn_mail').prop('disabled', false);
                                    $.notify(response.message, 'error');
                                }
                            },
                            Complete: function () {

                                $('#btn_mail').prop('disabled', false);
                            }
                        });
                    }
                },


                openUrl(url) {
                    window.open(url, '_blank');
                }

            },
            mounted() {
                //  this.getData();

                helper.blockUI();
                helper.unBlockUI();

                // this.getData();
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/xlsx@0.18.2/dist/xlsx.full.min.js';
                script.onload = () => {
                    this.xlsxLoaded = true; // Set flag to true when script is loaded
                };
                document.head.appendChild(script);

                this.Onchange();
                this.GetEmployeeMailInfo();
            },

        });




    </script>

}
